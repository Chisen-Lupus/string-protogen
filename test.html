<!DOCTYPE html>
<html lang='en'>

<head>
  
  <meta charset='UTF-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1.0'>
  <title>Protogen Half-Face Expression</title>

  <style>
    body {
      margin: 0;
      background-color: black;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    .canvas {
      position: absolute;
      /* testing purpose */
      width: 80vw;
      height: 50vw;
      border: 1px solid gray; 
    }

    /* eye */

    .eye-div {
      position: absolute;
      top: 0%;
      left: 40%;
      width: 60%;
      height: 50%;
    }

    /* eyelids and masks */
    .eye-div .upper-lid, .eye-div .lower-lid {
      fill: red;
      transition: d 0.1s ease-in-out;
    }
    .eye-div .upper-mask, .eye-div .lower-mask {
      fill: black;
      transition: d 0.1s ease-in-out;
    }

    /* eyeball and pupil */
    .eyeball {
      position: absolute;
      fill: pink;
      transition: transform 0.1s ease-in-out;
    }
    .pupil {
      fill: black;
      transition: transform 0.1s ease-in-out;
    }

    /* eye mark */

    .eye-mark-div {
      position: absolute;
      top: 28%;
      left: 45%;
      width: 50%;
      height: 30%;
    }
    .eye-mark {
      fill: red;
    }

    /* nose */

    .nose-div {
      position: absolute;
      top: 5%;
      left: 5%;
      width: 15%;
      height: 25%;
    }
    .nose {
      fill: red;
    }

    /* mouth */

    .mouth-div {
      position: absolute;
      bottom: 00%;
      left: 0%;
      width: 100%;
      height: 60%;
    }
    .mouth {
      fill: none;
      stroke: red;
      stroke-width: 2;
      stroke-linecap: round;
      transition: d 0.1s ease-in-out;
    }

    /* testing purpose */

    .hidden {
      display: none;
    }
    .showbox {
      background-color: rgba(255, 255, 255, 0.1); 
    }

  </style>

</head>

<body>

  <div class='canvas'>

    <!-- eye -->
    <div class='eye-div showbox'>
      <svg viewBox='0 0 100 50'>
        <circle class='eyeball' />
        <path class='pupil' />
        <path class='upper-mask' />
        <path class='lower-mask' />
        <path class='upper-lid' />
        <path class='lower-lid' />
      </svg>
    </div>

    <!-- nose -->
    <div class='nose-div showbox'>
      <svg viewBox='0 0 100 100'>
        <path class='nose' />
      </svg>
    </div>

    <!-- eye mark -->
    <div class='eye-mark-div showbox'>
      <svg viewBox='0 0 100 100'>
        <path class='eye-mark' />
      </svg>
    </div>

    <!-- mouth  -->
    <div class='mouth-div showbox'>
      <svg viewBox='0 0 100 100'>
        <path class='mouth' />
      </svg>
    </div>

    <!-- test -->
    <svg class='test' viewBox='0 0 100 100'>
      <path />
    </svg>

  </div>

  <script>

    // utility functions

    Element.prototype.setAttributes = function(attributes) {
      for (const key in attributes) {
        this.setAttribute(key, attributes[key]);
      }
    };

    // eye mark

    const eyeMarkPath = `
      M 5,90 T 20,80 T 60,42 T 90,12 T 95,10
      L 95,10 T 85,23 T 65,51 T 55,65
      L 55,65 T 70,56 T 85,47 T 92,45
      L 92,45 T 80,58 T 60,80 T 40,92 T 15,93 T 5,90
    `;
    const eyeMark = document.querySelector('.eye-mark')
    eyeMark.setAttribute('d', eyeMarkPath.trim());

    // mouth

    const mouthPathClosed = 'M10,20 Q 40,40 70,20 T 130,20 T 190,40 T 250,20';
    const mouthPathOpen = 'M10,20 Q 40,50 70,20 T 130,10 T 190,50 T 250,20';
    const mouth = document.querySelector('.mouth');
    mouth.setAttribute('d', mouthPathClosed);

    function toggleMouth() {
      const currentPath = mouth.getAttribute('d');
      if (currentPath===mouthPathClosed) {
        mouth.setAttribute('d', mouthPathOpen);
      } else {
        mouth.setAttribute('d', mouthPathClosed);
      }
    }

    setInterval(toggleMouth, 1000);

    // eyelid

    // opened svg paths
    const upperLidPathOpen = 'M10,20 Q 50,0 90,20';
    const lowerLidPathOpen = 'M10,35 Q 50,45 90,25';
    const upperMaskPathOpen = 'M10,15 Q 50,-5 90,15';
    const lowerMaskPathOpen = 'M10,40 Q 50,50 90,30';
    // closed svg states
    const upperLidPathClose = 'M10,30 Q 50,10 90,30';
    const lowerLidPathClose = 'M10,25 Q 50,35 90,15';
    const upperMaskPathClose = 'M10,25 Q 50,5 90,25';
    const lowerMaskPathClose = 'M10,30 Q 50,40 90,20';
    // get css variable
    const upperLid = document.querySelector('.upper-lid');
    const lowerLid = document.querySelector('.lower-lid');
    const upperMask = document.querySelector('.upper-mask');
    const lowerMask = document.querySelector('.lower-mask');
    // initialize to open state
    upperLid.setAttribute('d', upperLidPathOpen);
    lowerLid.setAttribute('d', lowerLidPathOpen);
    upperMask.setAttribute('d', upperMaskPathOpen);
    lowerMask.setAttribute('d', lowerMaskPathOpen);

    function blinkEye() {
      // close eye first
      upperLid.setAttribute('d', upperLidPathClose);
      lowerLid.setAttribute('d', lowerLidPathClose);
      upperMask.setAttribute('d', upperMaskPathClose);
      lowerMask.setAttribute('d', lowerMaskPathClose);
      // reopen eye after a delay
      setTimeout(() => {
        upperLid.setAttribute('d', upperLidPathOpen);
        lowerLid.setAttribute('d', lowerLidPathOpen);
        upperMask.setAttribute('d', upperMaskPathOpen);
        lowerMask.setAttribute('d', lowerMaskPathOpen);
      }, 200); // delay before reopening
    }

    // blink every 1 second (adjust as needed)
    setInterval(blinkEye, 5000);

    // pupil

    const eyeballAttributes = {cx: 50, cy: 25, r: 10};
    const pupilPath = 'M50,21 Q48,25 50,29 Q52,25 50,21'; 
    const eyeball = document.querySelector('.eyeball');
    const pupil = document.querySelector('.pupil');
    eyeball.setAttributes(eyeballAttributes);
    pupil.setAttribute('d', pupilPath);
    const eyeballPositions = [0, -3, 0, 3, 0];  
    const pupilPositions = [0, -5, 0, 5, 0];  

    function animateLookAround() {
      eyeball.style.transform = `translateX(${eyeballPositions[0]}px)`;
      pupil.style.transform = `translateX(${pupilPositions[0]}px)`;
      setTimeout(() => {
        eyeball.style.transform = `translateX(${eyeballPositions[1]}px)`;
        pupil.style.transform = `translateX(${pupilPositions[1]}px)`;
      }, 500); // Delay of 500ms
      setTimeout(() => {
        eyeball.style.transform = `translateX(${eyeballPositions[2]}px)`;
        pupil.style.transform = `translateX(${pupilPositions[2]}px)`;
      }, 1000); // Delay of 1000ms
      setTimeout(() => {
        eyeball.style.transform = `translateX(${eyeballPositions[3]}px)`;
        pupil.style.transform = `translateX(${pupilPositions[3]}px)`;
      }, 1500); // Delay of 1500ms
      setTimeout(() => {
        eyeball.style.transform = `translateX(${eyeballPositions[4]}px)`;
        pupil.style.transform = `translateX(${pupilPositions[4]}px)`;
      }, 2000); // Delay of 2000ms
    }

    setInterval(animateLookAround, 2500); // Repeat every 2.5 seconds

    // nose
    
    const nosePath = 'M 20,100 L 0,20 L 100,0 L 30,35 Z';
    const nose = document.querySelector('.nose')
    nose.setAttribute('d', nosePath);

  </script>

</body>

</html>
